<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Authentication Alternative - Implementation Plan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.4em;
            margin: 20px 0 10px 0;
        }
        
        .section h4 {
            color: #553c9a;
            font-size: 1.1em;
            margin: 15px 0 8px 0;
        }
        
        .problem-box {
            background: #fff5f5;
            border-left: 5px solid #e53e3e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .problem-box h4 {
            color: #e53e3e;
            margin-bottom: 10px;
        }
        
        .solution-box {
            background: #f0fff4;
            border-left: 5px solid #38a169;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .solution-box h4 {
            color: #38a169;
            margin-bottom: 10px;
        }
        
        .info-box {
            background: #ebf8ff;
            border-left: 5px solid #3182ce;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .info-box h4 {
            color: #3182ce;
            margin-bottom: 10px;
        }
        
        .warning-box {
            background: #fffaf0;
            border-left: 5px solid #dd6b20;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .warning-box h4 {
            color: #dd6b20;
            margin-bottom: 10px;
        }
        
        code {
            background: #f7fafc;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e53e3e;
            font-size: 0.9em;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
        }
        
        pre code {
            background: transparent;
            color: #e2e8f0;
            padding: 0;
        }
        
        .code-label {
            position: absolute;
            top: 5px;
            right: 10px;
            background: #4a5568;
            color: #cbd5e0;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: bold;
        }
        
        .step-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }
        
        .step-list li {
            counter-increment: step-counter;
            margin: 25px 0;
            padding-left: 60px;
            position: relative;
        }
        
        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background: #f7fafc;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }
        
        .badge-error {
            background: #fed7d7;
            color: #c53030;
        }
        
        .badge-success {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        .badge-info {
            background: #bee3f8;
            color: #2c5282;
        }
        
        .badge-warning {
            background: #feebc8;
            color: #c05621;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .comparison-item.okta {
            background: #fff5f5;
            border-color: #e53e3e;
        }
        
        .comparison-item.jwt {
            background: #f0fff4;
            border-color: #38a169;
        }
        
        .comparison-item h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .comparison-item.okta h4 {
            color: #e53e3e;
        }
        
        .comparison-item.jwt h4 {
            color: #38a169;
        }
        
        .footer {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .footer p {
            margin: 5px 0;
        }
        
        .highlight {
            background: #fefcbf;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        ul {
            margin: 15px 0;
            padding-left: 20px;
        }
        
        ul li {
            margin: 10px 0;
        }
        
        .flow-diagram {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .flow-step {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            position: relative;
        }
        
        .flow-arrow {
            display: inline-block;
            color: #667eea;
            font-size: 1.5em;
            margin: 0 10px;
        }
        
        .api-endpoint {
            background: #2d3748;
            color: #48bb78;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            display: inline-block;
        }
        
        .method {
            background: #ed8936;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .method.get { background: #48bb78; }
        .method.post { background: #4299e1; }
        .method.put { background: #ed8936; }
        .method.delete { background: #f56565; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê JWT Authentication Alternative</h1>
            <p>Self-Contained Authentication System for API Gateway</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Replacing Okta OAuth2 with Custom JWT Solution</p>
        </div>
        
        <div class="content">
            <!-- Problem Statement -->
            <div class="section">
                <h2>‚ùå Current Problem</h2>
                
                <div class="problem-box">
                    <h4>Okta OAuth2 Integration Blocked</h4>
                    <p>The API Gateway cannot authenticate users through Okta due to Amadeus corporate network restrictions, specifically:</p>
                    <ul>
                        <li><strong>SSL Inspection Issues:</strong> While certificate validation was fixed, other network policies are blocking OAuth2 flow</li>
                        <li><strong>User Assignment Restrictions:</strong> Okta application access policies preventing user login</li>
                        <li><strong>Corporate Firewall Rules:</strong> Potential blocking of OAuth2 redirect flows</li>
                        <li><strong>Policy Evaluation Failures:</strong> Okta's internal policies rejecting authorization requests</li>
                    </ul>
                </div>
                
                <h3>Original Architecture</h3>
                <div class="comparison">
                    <div class="comparison-item okta">
                        <h4>‚ùå Okta OAuth2 (Current - Not Working)</h4>
                        <ul>
                            <li>External identity provider (Okta)</li>
                            <li>OAuth2 Authorization Code flow</li>
                            <li>Requires external network connectivity</li>
                            <li>Dependent on corporate network policies</li>
                            <li>User assignment managed in Okta</li>
                            <li>Complex configuration in Okta console</li>
                        </ul>
                    </div>
                    
                    <div class="comparison-item jwt">
                        <h4>‚úÖ Custom JWT (Alternative - Proposed)</h4>
                        <ul>
                            <li>Self-contained authentication</li>
                            <li>JWT token generation & validation</li>
                            <li>No external dependencies</li>
                            <li>Works within corporate network</li>
                            <li>User management in application</li>
                            <li>Full control over authentication logic</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Solution Overview -->
            <div class="section">
                <h2>‚úÖ Proposed Solution: JWT-Based Authentication</h2>
                
                <div class="solution-box">
                    <h4>Self-Contained JWT Authentication System</h4>
                    <p>Implement a complete authentication system within the API Gateway that generates and validates JSON Web Tokens (JWT) without requiring external identity providers.</p>
                </div>
                
                <h3>Architecture Overview</h3>
                <div class="flow-diagram">
                    <div class="flow-step">User Login Request</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-step">Validate Credentials</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-step">Generate JWT Token</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-step">Return Token</div>
                    <br><br>
                    <div class="flow-step">User API Request + Token</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-step">Validate JWT</div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-step">Route to Service</div>
                </div>
                
                <h3>Key Components</h3>
                <table>
                    <tr>
                        <th>Component</th>
                        <th>Purpose</th>
                        <th>Technology</th>
                    </tr>
                    <tr>
                        <td><strong>JWT Utility</strong></td>
                        <td>Generate and validate JWT tokens</td>
                        <td>JJWT Library (io.jsonwebtoken)</td>
                    </tr>
                    <tr>
                        <td><strong>Authentication Filter</strong></td>
                        <td>Intercept requests and validate tokens</td>
                        <td>WebFilter (Reactive)</td>
                    </tr>
                    <tr>
                        <td><strong>Login Controller</strong></td>
                        <td>Handle login requests and issue tokens</td>
                        <td>REST Controller</td>
                    </tr>
                    <tr>
                        <td><strong>User Service</strong></td>
                        <td>Manage user credentials and roles</td>
                        <td>Reactive UserDetailsService</td>
                    </tr>
                    <tr>
                        <td><strong>Security Config</strong></td>
                        <td>Configure Spring Security for JWT</td>
                        <td>WebFlux Security</td>
                    </tr>
                </table>
            </div>
            
            <!-- Implementation Plan -->
            <div class="section">
                <h2>üìã Implementation Plan</h2>
                
                <ol class="step-list">
                    <li>
                        <strong>Update Maven Dependencies</strong>
                        <p>Remove Okta dependency and add JWT libraries</p>
                        <pre><code>&lt;!-- Remove Okta --&gt;
&lt;!-- DELETE THIS --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.okta.spring&lt;/groupId&gt;
    &lt;artifactId&gt;okta-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;3.0.7&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Add JWT Dependencies --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt-api&lt;/artifactId&gt;
    &lt;version&gt;0.12.3&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt-impl&lt;/artifactId&gt;
    &lt;version&gt;0.12.3&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt-jackson&lt;/artifactId&gt;
    &lt;version&gt;0.12.3&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
                    </li>
                    
                    <li>
                        <strong>Update application.yml Configuration</strong>
                        <p>Remove Okta configuration and add JWT settings</p>
                        <pre><code># Remove all Okta configuration
# DELETE THESE SECTIONS:
spring:
  security:
    oauth2:
      client:
        registration:
          okta: ...
        provider:
          okta: ...

okta:
  oauth2: ...

# Add JWT Configuration
jwt:
  secret: YourSuperSecretKeyThatShouldBeAtLeast256BitsLongForHS256Algorithm
  expiration: 86400000  # 24 hours in milliseconds
  issuer: api-gateway

server:
  port: 8084

# Keep Eureka configuration as-is
eureka:
  instance:
    hostname: localhost
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/</code></pre>
                    </li>
                    
                    <li>
                        <strong>Create JWT Utility Class</strong>
                        <p>File: <code>util/JwtUtil.java</code></p>
                        <pre><code>package com.cna.api.gateway.ApiGateway.util;

import io.jsonwebtoken.*;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

@Component
public class JwtUtil {

    @Value("${jwt.secret}")
    private String secret;

    @Value("${jwt.expiration}")
    private Long expiration;

    @Value("${jwt.issuer}")
    private String issuer;

    private SecretKey getSigningKey() {
        return Keys.hmacShaKeyFor(secret.getBytes());
    }

    // Generate token with username and roles
    public String generateToken(String username, String role) {
        Map&lt;String, Object&gt; claims = new HashMap&lt;&gt;();
        claims.put("role", role);
        
        return Jwts.builder()
                .claims(claims)
                .subject(username)
                .issuer(issuer)
                .issuedAt(new Date())
                .expiration(new Date(System.currentTimeMillis() + expiration))
                .signWith(getSigningKey())
                .compact();
    }

    // Validate token
    public boolean validateToken(String token) {
        try {
            Jwts.parser()
                .verifyWith(getSigningKey())
                .build()
                .parseSignedClaims(token);
            return true;
        } catch (JwtException | IllegalArgumentException e) {
            return false;
        }
    }

    // Extract username from token
    public String extractUsername(String token) {
        return Jwts.parser()
                .verifyWith(getSigningKey())
                .build()
                .parseSignedClaims(token)
                .getPayload()
                .getSubject();
    }

    // Extract role from token
    public String extractRole(String token) {
        return Jwts.parser()
                .verifyWith(getSigningKey())
                .build()
                .parseSignedClaims(token)
                .getPayload()
                .get("role", String.class);
    }

    // Check if token is expired
    public boolean isTokenExpired(String token) {
        try {
            Date expiration = Jwts.parser()
                    .verifyWith(getSigningKey())
                    .build()
                    .parseSignedClaims(token)
                    .getPayload()
                    .getExpiration();
            return expiration.before(new Date());
        } catch (JwtException e) {
            return true;
        }
    }
}</code></pre>
                    </li>
                    
                    <li>
                        <strong>Create Authentication Models</strong>
                        <p>File: <code>models/LoginRequest.java</code></p>
                        <pre><code>package com.cna.api.gateway.ApiGateway.models;

import lombok.Data;

@Data
public class LoginRequest {
    private String username;
    private String password;
}</code></pre>
                        <p>File: <code>models/AuthResponse.java</code></p>
                        <pre><code>package com.cna.api.gateway.ApiGateway.models;

import lombok.AllArgsConstructor;
import lombok.Data;

@Data
@AllArgsConstructor
public class AuthResponse {
    private String token;
    private String username;
    private String role;
    private long expiresIn;
    private String message;
}</code></pre>
                    </li>
                    
                    <li>
                        <strong>Create Authentication Controller</strong>
                        <p>File: <code>controllers/AuthController.java</code></p>
                        <pre><code>package com.cna.api.gateway.ApiGateway.controllers;

import com.cna.api.gateway.ApiGateway.models.AuthResponse;
import com.cna.api.gateway.ApiGateway.models.LoginRequest;
import com.cna.api.gateway.ApiGateway.util.JwtUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import reactor.core.publisher.Mono;

@RestController
@RequestMapping("/auth")
@RequiredArgsConstructor
public class AuthController {

    private final JwtUtil jwtUtil;

    @PostMapping("/login")
    public Mono&lt;ResponseEntity&lt;AuthResponse&gt;&gt; login(@RequestBody LoginRequest request) {
        return Mono.fromCallable(() -&gt; {
            // TODO: Replace with actual user validation from database
            // For now, hardcoded user for testing
            if ("admin".equals(request.getUsername()) && "admin123".equals(request.getPassword())) {
                String token = jwtUtil.generateToken(request.getUsername(), "ADMIN");
                
                return ResponseEntity.ok(new AuthResponse(
                    token,
                    request.getUsername(),
                    "ADMIN",
                    86400000L, // 24 hours
                    "Login successful"
                ));
            } else if ("user".equals(request.getUsername()) && "user123".equals(request.getPassword())) {
                String token = jwtUtil.generateToken(request.getUsername(), "USER");
                
                return ResponseEntity.ok(new AuthResponse(
                    token,
                    request.getUsername(),
                    "USER",
                    86400000L,
                    "Login successful"
                ));
            } else {
                return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
                    .body(new AuthResponse(null, null, null, 0, "Invalid credentials"));
            }
        });
    }

    @GetMapping("/validate")
    public Mono&lt;ResponseEntity&lt;String&gt;&gt; validateToken(@RequestHeader("Authorization") String authHeader) {
        return Mono.fromCallable(() -&gt; {
            if (authHeader != null && authHeader.startsWith("Bearer ")) {
                String token = authHeader.substring(7);
                if (jwtUtil.validateToken(token)) {
                    String username = jwtUtil.extractUsername(token);
                    return ResponseEntity.ok("Token is valid for user: " + username);
                }
            }
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("Invalid token");
        });
    }
}</code></pre>
                    </li>
                    
                    <li>
                        <strong>Create JWT Authentication Filter</strong>
                        <p>File: <code>config/JwtAuthenticationFilter.java</code></p>
                        <pre><code>package com.cna.api.gateway.ApiGateway.config;

import com.cna.api.gateway.ApiGateway.util.JwtUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.context.ReactiveSecurityContextHolder;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import org.springframework.web.server.WebFilter;
import org.springframework.web.server.WebFilterChain;
import reactor.core.publisher.Mono;

import java.util.Collections;

@Component
@RequiredArgsConstructor
public class JwtAuthenticationFilter implements WebFilter {

    private final JwtUtil jwtUtil;

    @Override
    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, WebFilterChain chain) {
        String path = exchange.getRequest().getPath().value();
        
        // Skip authentication for login endpoint
        if (path.equals("/auth/login")) {
            return chain.filter(exchange);
        }

        String authHeader = exchange.getRequest().getHeaders().getFirst(HttpHeaders.AUTHORIZATION);
        
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            String token = authHeader.substring(7);
            
            if (jwtUtil.validateToken(token) && !jwtUtil.isTokenExpired(token)) {
                String username = jwtUtil.extractUsername(token);
                String role = jwtUtil.extractRole(token);
                
                UsernamePasswordAuthenticationToken authentication = 
                    new UsernamePasswordAuthenticationToken(
                        username, 
                        null, 
                        Collections.singletonList(new SimpleGrantedAuthority("ROLE_" + role))
                    );
                
                return chain.filter(exchange)
                    .contextWrite(ReactiveSecurityContextHolder.withAuthentication(authentication));
            }
        }
        
        // No valid token - return 401 Unauthorized
        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
        return exchange.getResponse().setComplete();
    }
}</code></pre>
                    </li>
                    
                    <li>
                        <strong>Update SecurityConfig</strong>
                        <p>Replace current OAuth2 configuration with JWT filter</p>
                        <pre><code>package com.cna.api.gateway.ApiGateway.config;

import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;
import org.springframework.security.config.web.server.SecurityWebFiltersOrder;
import org.springframework.security.config.web.server.ServerHttpSecurity;
import org.springframework.security.web.server.SecurityWebFilterChain;

@Configuration
@EnableWebFluxSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthenticationFilter jwtAuthenticationFilter;

    @Bean
    public SecurityWebFilterChain securityWebFilterChain(ServerHttpSecurity http) {
        return http
            .csrf(ServerHttpSecurity.CsrfSpec::disable)
            .authorizeExchange(exchanges -&gt; exchanges
                .pathMatchers("/auth/login", "/auth/register").permitAll()
                .pathMatchers("/actuator/**").permitAll()
                .anyExchange().authenticated()
            )
            .addFilterAt(jwtAuthenticationFilter, SecurityWebFiltersOrder.AUTHENTICATION)
            .build();
    }
}</code></pre>
                    </li>
                    
                    <li>
                        <strong>Test the Implementation</strong>
                        <p>Use the following API endpoints</p>
                    </li>
                </ol>
            </div>
            
            <!-- API Endpoints -->
            <div class="section">
                <h2>üîå API Endpoints</h2>
                
                <h3>1. Login Endpoint</h3>
                <div class="api-endpoint">
                    <span class="method post">POST</span> /auth/login
                </div>
                <pre><code><span class="code-label">Request</span>
{
    "username": "admin",
    "password": "admin123"
}
</code></pre>
                <pre><code><span class="code-label">Response (Success)</span>
{
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "username": "admin",
    "role": "ADMIN",
    "expiresIn": 86400000,
    "message": "Login successful"
}
</code></pre>
                
                <h3>2. Validate Token Endpoint</h3>
                <div class="api-endpoint">
                    <span class="method get">GET</span> /auth/validate
                </div>
                <pre><code><span class="code-label">Headers</span>
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
</code></pre>
                
                <h3>3. Access Protected Routes</h3>
                <div class="api-endpoint">
                    <span class="method get">GET</span> /users/**
                </div>
                <div class="api-endpoint">
                    <span class="method get">GET</span> /hotels/**
                </div>
                <div class="api-endpoint">
                    <span class="method get">GET</span> /ratings/**
                </div>
                <pre><code><span class="code-label">Headers</span>
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
</code></pre>
                
                <h3>Default Test Users</h3>
                <table>
                    <tr>
                        <th>Username</th>
                        <th>Password</th>
                        <th>Role</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><code>admin</code></td>
                        <td><code>admin123</code></td>
                        <td><span class="badge badge-error">ADMIN</span></td>
                        <td>Full access to all services</td>
                    </tr>
                    <tr>
                        <td><code>user</code></td>
                        <td><code>user123</code></td>
                        <td><span class="badge badge-info">USER</span></td>
                        <td>Standard user access</td>
                    </tr>
                </table>
                
                <div class="warning-box">
                    <h4>‚ö†Ô∏è Important Note</h4>
                    <p>The hardcoded users above are for <strong>testing only</strong>. In production, you should:</p>
                    <ul>
                        <li>Integrate with a database (H2, MySQL, PostgreSQL)</li>
                        <li>Use Spring Security's UserDetailsService</li>
                        <li>Hash passwords with BCrypt</li>
                        <li>Implement user registration endpoints</li>
                    </ul>
                </div>
            </div>
            
            <!-- Testing Guide -->
            <div class="section">
                <h2>üß™ Testing Guide</h2>
                
                <h3>Using Postman or cURL</h3>
                
                <h4>Step 1: Login</h4>
                <pre><code><span class="code-label">cURL</span>
curl -X POST http://localhost:8084/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
</code></pre>
                
                <h4>Step 2: Copy the Token</h4>
                <pre><code><span class="code-label">Response</span>
{
    "token": "eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJzdWIiOiJhZG1pbiIsImlzcyI6ImFwaS1nYXRld2F5IiwiaWF0IjoxNzM4NjU2MDAwLCJleHAiOjE3Mzg3NDI0MDB9.xyz123",
    "username": "admin",
    "role": "ADMIN",
    "expiresIn": 86400000,
    "message": "Login successful"
}
</code></pre>
                
                <h4>Step 3: Access Protected Route</h4>
                <pre><code><span class="code-label">cURL</span>
curl -X GET http://localhost:8084/users/all \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
</code></pre>
                
                <h3>Using Browser (Chrome/Firefox)</h3>
                <ol>
                    <li>Install a browser extension like "ModHeader" or "REST Client"</li>
                    <li>Login via POST to <code>/auth/login</code></li>
                    <li>Add the token to the Authorization header</li>
                    <li>Access protected routes</li>
                </ol>
            </div>
            
            <!-- Advantages and Limitations -->
            <div class="section">
                <h2>‚öñÔ∏è Advantages vs Limitations</h2>
                
                <h3>Advantages of JWT Authentication</h3>
                <div class="solution-box">
                    <ul>
                        <li>‚úÖ <strong>No External Dependencies:</strong> Works entirely within your infrastructure</li>
                        <li>‚úÖ <strong>Network Independent:</strong> Not affected by corporate firewall/proxy policies</li>
                        <li>‚úÖ <strong>Full Control:</strong> Complete control over authentication logic and user management</li>
                        <li>‚úÖ <strong>Stateless:</strong> JWT tokens contain all necessary information, no session storage needed</li>
                        <li>‚úÖ <strong>Scalable:</strong> Tokens can be validated by any service instance</li>
                        <li>‚úÖ <strong>Simple Integration:</strong> Easy to integrate with microservices</li>
                        <li>‚úÖ <strong>Cost Effective:</strong> No licensing or external service costs</li>
                    </ul>
                </div>
                
                <h3>Limitations</h3>
                <div class="warning-box">
                    <ul>
                        <li>‚ö†Ô∏è <strong>User Management:</strong> You need to build your own user database and management</li>
                        <li>‚ö†Ô∏è <strong>Token Revocation:</strong> Revoking tokens before expiration requires additional logic (blacklist)</li>
                        <li>‚ö†Ô∏è <strong>Security Responsibility:</strong> You're responsible for secure key management</li>
                        <li>‚ö†Ô∏è <strong>No SSO:</strong> No single sign-on across multiple applications</li>
                        <li>‚ö†Ô∏è <strong>Password Management:</strong> Need to implement password reset, email verification, etc.</li>
                        <li>‚ö†Ô∏è <strong>MFA:</strong> Multi-factor authentication requires custom implementation</li>
                    </ul>
                </div>
                
                <h3>Comparison Table</h3>
                <table>
                    <tr>
                        <th>Feature</th>
                        <th>Okta OAuth2</th>
                        <th>Custom JWT</th>
                    </tr>
                    <tr>
                        <td>External Dependencies</td>
                        <td><span class="badge badge-error">High</span></td>
                        <td><span class="badge badge-success">None</span></td>
                    </tr>
                    <tr>
                        <td>Network Requirements</td>
                        <td><span class="badge badge-error">Internet Required</span></td>
                        <td><span class="badge badge-success">Local Only</span></td>
                    </tr>
                    <tr>
                        <td>Setup Complexity</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td><span class="badge badge-info">Low</span></td>
                    </tr>
                    <tr>
                        <td>User Management</td>
                        <td><span class="badge badge-success">Built-in</span></td>
                        <td><span class="badge badge-warning">Manual</span></td>
                    </tr>
                    <tr>
                        <td>SSO Support</td>
                        <td><span class="badge badge-success">Yes</span></td>
                        <td><span class="badge badge-error">No</span></td>
                    </tr>
                    <tr>
                        <td>Corporate Network Issues</td>
                        <td><span class="badge badge-error">Blocked</span></td>
                        <td><span class="badge badge-success">Works</span></td>
                    </tr>
                    <tr>
                        <td>Cost</td>
                        <td><span class="badge badge-warning">$$$</span></td>
                        <td><span class="badge badge-success">Free</span></td>
                    </tr>
                    <tr>
                        <td>Control</td>
                        <td><span class="badge badge-warning">Limited</span></td>
                        <td><span class="badge badge-success">Full</span></td>
                    </tr>
                </table>
            </div>
            
            <!-- Future Enhancements -->
            <div class="section">
                <h2>üöÄ Future Enhancements</h2>
                
                <h3>Phase 1: Basic Implementation (Covered in Plan)</h3>
                <ul>
                    <li>‚úÖ JWT token generation and validation</li>
                    <li>‚úÖ Login endpoint with hardcoded users</li>
                    <li>‚úÖ Authentication filter for route protection</li>
                    <li>‚úÖ Role-based access control (ADMIN, USER)</li>
                </ul>
                
                <h3>Phase 2: Database Integration</h3>
                <ul>
                    <li>Add H2/MySQL database for user storage</li>
                    <li>Implement Spring Data Reactive repositories</li>
                    <li>Use BCrypt for password hashing</li>
                    <li>Create user registration endpoint</li>
                </ul>
                <pre><code>// Example User Entity
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String username;
    private String password; // BCrypt hashed
    private String email;
    private String role;
    private boolean enabled;
    private LocalDateTime createdAt;
}</code></pre>
                
                <h3>Phase 3: Advanced Security</h3>
                <ul>
                    <li>Token refresh mechanism (refresh tokens)</li>
                    <li>Token blacklist for logout/revocation</li>
                    <li>Password reset via email</li>
                    <li>Account lockout after failed attempts</li>
                    <li>Email verification for new accounts</li>
                </ul>
                
                <h3>Phase 4: Monitoring and Logging</h3>
                <ul>
                    <li>Authentication audit logging</li>
                    <li>Failed login attempt tracking</li>
                    <li>Token usage analytics</li>
                    <li>Security event notifications</li>
                </ul>
            </div>
            
            <!-- Security Best Practices -->
            <div class="section">
                <h2>üîí Security Best Practices</h2>
                
                <div class="warning-box">
                    <h4>Critical Security Considerations</h4>
                    
                    <h4>1. JWT Secret Management</h4>
                    <ul>
                        <li><strong>Never hardcode secrets</strong> in application.yml for production</li>
                        <li>Use environment variables or Spring Cloud Config</li>
                        <li>Secret must be at least 256 bits (32 characters) for HS256</li>
                        <li>Rotate secrets periodically</li>
                    </ul>
                    
                    <pre><code># Bad (Development Only)
jwt:
  secret: YourSuperSecretKey

# Good (Production)
jwt:
  secret: ${JWT_SECRET}  # Set via environment variable

# PowerShell (Windows)
$env:JWT_SECRET = "YourVeryLongAndComplexSecretKeyThatIsAtLeast256BitsLong"

# Linux/Mac
export JWT_SECRET="YourVeryLongAndComplexSecretKeyThatIsAtLeast256BitsLong"</code></pre>
                    
                    <h4>2. Password Security</h4>
                    <ul>
                        <li>Always use BCrypt for password hashing (not plain text)</li>
                        <li>Enforce strong password policies (min length, complexity)</li>
                        <li>Never log passwords</li>
                        <li>Implement password expiration</li>
                    </ul>
                    
                    <h4>3. Token Security</h4>
                    <ul>
                        <li>Set reasonable expiration times (24 hours recommended)</li>
                        <li>Use HTTPS in production (not HTTP)</li>
                        <li>Store tokens securely on client side (HttpOnly cookies preferred)</li>
                        <li>Implement token refresh mechanism</li>
                    </ul>
                    
                    <h4>4. CORS Configuration</h4>
                    <ul>
                        <li>Restrict allowed origins in production</li>
                        <li>Don't use <code>allowedOrigins("*")</code> in production</li>
                        <li>Specify exact frontend URLs</li>
                    </ul>
                    
                    <h4>5. Rate Limiting</h4>
                    <ul>
                        <li>Implement rate limiting on login endpoint</li>
                        <li>Prevent brute force attacks</li>
                        <li>Use Spring Cloud Gateway rate limiter</li>
                    </ul>
                </div>
            </div>
            
            <!-- Implementation Checklist -->
            <div class="section">
                <h2>‚úÖ Pre-Implementation Checklist</h2>
                
                <div class="info-box">
                    <h4>Before Starting Implementation</h4>
                    <table>
                        <tr>
                            <th>Task</th>
                            <th>Status</th>
                            <th>Notes</th>
                        </tr>
                        <tr>
                            <td>Backup current code</td>
                            <td>‚¨ú</td>
                            <td>Create git branch or backup folder</td>
                        </tr>
                        <tr>
                            <td>Review dependencies</td>
                            <td>‚¨ú</td>
                            <td>Check Maven compatibility</td>
                        </tr>
                        <tr>
                            <td>Generate JWT secret</td>
                            <td>‚¨ú</td>
                            <td>Use strong random generator</td>
                        </tr>
                        <tr>
                            <td>Test environment ready</td>
                            <td>‚¨ú</td>
                            <td>Postman/cURL installed</td>
                        </tr>
                        <tr>
                            <td>Understand JWT flow</td>
                            <td>‚¨ú</td>
                            <td>Review architecture diagram</td>
                        </tr>
                        <tr>
                            <td>Plan user management</td>
                            <td>‚¨ú</td>
                            <td>Hardcoded vs database</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <!-- Troubleshooting -->
            <div class="section">
                <h2>üîß Common Issues and Solutions</h2>
                
                <h3>Issue 1: Token Validation Fails</h3>
                <div class="problem-box">
                    <p><strong>Symptom:</strong> Getting 401 Unauthorized even with valid token</p>
                    <p><strong>Causes:</strong></p>
                    <ul>
                        <li>JWT secret mismatch between generation and validation</li>
                        <li>Token expired</li>
                        <li>Bearer prefix missing in Authorization header</li>
                    </ul>
                    <p><strong>Solution:</strong></p>
                    <ul>
                        <li>Verify JWT secret is same in application.yml</li>
                        <li>Check token expiration time</li>
                        <li>Ensure header format: <code>Authorization: Bearer [token]</code></li>
                    </ul>
                </div>
                
                <h3>Issue 2: CORS Errors</h3>
                <div class="problem-box">
                    <p><strong>Symptom:</strong> Browser blocks requests with CORS error</p>
                    <p><strong>Solution:</strong> Add CORS configuration to SecurityConfig</p>
                    <pre><code>@Bean
public CorsWebFilter corsWebFilter() {
    CorsConfiguration config = new CorsConfiguration();
    config.setAllowedOrigins(Arrays.asList("http://localhost:3000"));
    config.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE"));
    config.setAllowedHeaders(Arrays.asList("*"));
    config.setAllowCredentials(true);
    
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/**", config);
    
    return new CorsWebFilter(source);
}</code></pre>
                </div>
                
                <h3>Issue 3: Filter Not Applied</h3>
                <div class="problem-box">
                    <p><strong>Symptom:</strong> JwtAuthenticationFilter not intercepting requests</p>
                    <p><strong>Solution:</strong></p>
                    <ul>
                        <li>Ensure <code>@Component</code> annotation on filter class</li>
                        <li>Verify filter is added to SecurityWebFilterChain</li>
                        <li>Check filter order in configuration</li>
                    </ul>
                </div>
            </div>
            
            <!-- Next Steps -->
            <div class="section">
                <h2>üéØ Next Steps</h2>
                
                <div class="solution-box">
                    <h4>Ready to Implement?</h4>
                    <ol class="step-list" style="list-style: decimal; padding-left: 40px;">
                        <li style="padding-left: 10px;">
                            <strong>Review this document thoroughly</strong>
                            <p>Understand each component and its purpose</p>
                        </li>
                        <li style="padding-left: 10px;">
                            <strong>Create a backup branch</strong>
                            <pre><code>git checkout -b feature/jwt-authentication</code></pre>
                        </li>
                        <li style="padding-left: 10px;">
                            <strong>Follow implementation plan step by step</strong>
                            <p>Start with dependencies, then utility classes, then controllers</p>
                        </li>
                        <li style="padding-left: 10px;">
                            <strong>Test each component individually</strong>
                            <p>Test JWT generation, validation, login, protected routes</p>
                        </li>
                        <li style="padding-left: 10px;">
                            <strong>Document your implementation</strong>
                            <p>Keep track of changes and configurations</p>
                        </li>
                    </ol>
                </div>
                
                <div class="info-box">
                    <h4>Need Help?</h4>
                    <p>If you need assistance implementing any of these components or encounter issues:</p>
                    <ul>
                        <li>Review the code examples in this document</li>
                        <li>Check the troubleshooting section</li>
                        <li>Test each component individually before integration</li>
                        <li>Use logging extensively during development</li>
                    </ul>
                </div>
            </div>
            
            <!-- Summary -->
            <div class="section">
                <h2>üìä Summary</h2>
                
                <div class="solution-box">
                    <h4>What This Solution Provides</h4>
                    <ul>
                        <li>‚úÖ <strong>Self-contained authentication</strong> - No Okta or external dependencies</li>
                        <li>‚úÖ <strong>JWT-based security</strong> - Industry standard token-based auth</li>
                        <li>‚úÖ <strong>Works in corporate networks</strong> - Not affected by proxy/firewall</li>
                        <li>‚úÖ <strong>Full control</strong> - Complete customization of auth logic</li>
                        <li>‚úÖ <strong>Scalable</strong> - Stateless tokens work across multiple instances</li>
                        <li>‚úÖ <strong>Role-based access</strong> - Support for ADMIN, USER roles</li>
                        <li>‚úÖ <strong>Production ready</strong> - With proper security configuration</li>
                    </ul>
                </div>
                
                <h3>Files to be Created/Modified</h3>
                <table>
                    <tr>
                        <th>File</th>
                        <th>Action</th>
                        <th>Purpose</th>
                    </tr>
                    <tr>
                        <td><code>pom.xml</code></td>
                        <td><span class="badge badge-warning">Modify</span></td>
                        <td>Replace Okta with JWT dependencies</td>
                    </tr>
                    <tr>
                        <td><code>application.yml</code></td>
                        <td><span class="badge badge-warning">Modify</span></td>
                        <td>Remove Okta config, add JWT settings</td>
                    </tr>
                    <tr>
                        <td><code>SecurityConfig.java</code></td>
                        <td><span class="badge badge-warning">Modify</span></td>
                        <td>Replace OAuth2 with JWT filter</td>
                    </tr>
                    <tr>
                        <td><code>util/JwtUtil.java</code></td>
                        <td><span class="badge badge-success">Create</span></td>
                        <td>JWT token generation and validation</td>
                    </tr>
                    <tr>
                        <td><code>config/JwtAuthenticationFilter.java</code></td>
                        <td><span class="badge badge-success">Create</span></td>
                        <td>Intercept and validate requests</td>
                    </tr>
                    <tr>
                        <td><code>controllers/AuthController.java</code></td>
                        <td><span class="badge badge-success">Create</span></td>
                        <td>Login and token endpoints</td>
                    </tr>
                    <tr>
                        <td><code>models/LoginRequest.java</code></td>
                        <td><span class="badge badge-success">Create</span></td>
                        <td>Login request DTO</td>
                    </tr>
                    <tr>
                        <td><code>models/AuthResponse.java</code></td>
                        <td><span class="badge badge-success">Create</span></td>
                        <td>Authentication response DTO</td>
                    </tr>
                </table>
                
                <h3>Estimated Implementation Time</h3>
                <ul>
                    <li><strong>Basic Setup:</strong> 1-2 hours (dependencies, configuration)</li>
                    <li><strong>Core Implementation:</strong> 2-3 hours (JWT util, filter, controller)</li>
                    <li><strong>Testing:</strong> 1-2 hours (Postman tests, troubleshooting)</li>
                    <li><strong>Total:</strong> 4-7 hours for complete implementation</li>
                </ul>
            </div>
        </div>
        
        <div class="footer">
            <p><strong>JWT Authentication Alternative - API Gateway</strong></p>
            <p>Self-Contained Authentication System for Microservices</p>
            <p style="margin-top: 15px; opacity: 0.8;">Documentation Created: February 4, 2026</p>
            <p style="margin-top: 10px; opacity: 0.7;">Spring Boot 3.2.0 | Java 21 | JWT (JJWT 0.12.3) | Spring Cloud Gateway</p>
            <p style="margin-top: 15px; opacity: 0.6;">Alternative to Okta OAuth2 due to corporate network restrictions</p>
        </div>
    </div>
</body>
</html>
